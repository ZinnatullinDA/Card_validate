#!/bin/sh

# === –¶–≤–µ—Ç–æ–≤—ã–µ –∫–æ–¥—ã ANSI –¥–ª—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤—ã–≤–æ–¥–∞ ===
RED='\033[0;31m'    # –ö—Ä–∞—Å–Ω—ã–π (–æ—à–∏–±–∫–∏)
GREEN='\033[0;32m'  # –ó–µ–ª—ë–Ω—ã–π (—É—Å–ø–µ—Ö)
YELLOW='\033[1;33m' # –ñ—ë–ª—Ç—ã–π (–∏–Ω—Ñ–æ)
BLUE='\033[1;34m'   # –°–∏–Ω–∏–π (–∑–∞–≥–æ–ª–æ–≤–∫–∏)
NC='\033[0m'        # –°–±—Ä–æ—Å —Ü–≤–µ—Ç–∞

# === –°—Ç–∞—Ä—Ç –æ–±—â–µ–≥–æ —Ç–∞–π–º–µ—Ä–∞ ===
total_start=$(date +%s)

# –ó–∞–≥–æ–ª–æ–≤–æ–∫
printf "${BLUE}üöÄ –ó–∞–ø—É—Å–∫ pre-commit —Ö—É–∫–æ–≤...${NC}\n"

# === –®–∞–≥ 1: ESLint —Å –∞–≤—Ç–æ—Ñ–∏–∫—Å–∞–º–∏ ===
eslint_start=$(date +%s)
printf "${YELLOW}üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏ –∞–≤—Ç–æ–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ ESLint...${NC}\n"
npm run lint:fix
if [ $? -ne 0 ]; then
  printf "${RED}‚ùå –û—à–∏–±–∫–∏ ESLint! –ö–æ–º–º–∏—Ç –æ—Ç–º–µ–Ω—ë–Ω.${NC}\n"
  exit 1
fi
eslint_end=$(date +%s)
eslint_elapsed=$((eslint_end - eslint_start))
printf "${GREEN}‚úÖ ESLint –ø—Ä–æ–π–¥–µ–Ω —É—Å–ø–µ—à–Ω–æ –∑–∞ ${eslint_elapsed} —Å–µ–∫.${NC}\n"

# –î–æ–±–∞–≤–ª—è–µ–º –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã –≤ –∏–Ω–¥–µ–∫—Å
git add .

# === –®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–∏–∑–∞—Ü–∏–∏ TypeScript ===
ts_start=$(date +%s)
printf "${YELLOW}üîé –ü—Ä–æ–≤–µ—Ä–∫–∞ TypeScript...${NC}\n"
npm run type-check
if [ $? -ne 0 ]; then
  printf "${RED}‚ùå –û—à–∏–±–∫–∏ TypeScript! –ö–æ–º–º–∏—Ç –æ—Ç–º–µ–Ω—ë–Ω.${NC}\n"
  exit 1
fi
ts_end=$(date +%s)
ts_elapsed=$((ts_end - ts_start))
printf "${GREEN}‚úÖ TypeScript –ø—Ä–æ–π–¥–µ–Ω —É—Å–ø–µ—à–Ω–æ –∑–∞ ${ts_elapsed} —Å–µ–∫.${NC}\n"

# === –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ: –û–±—â–µ–µ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è ===
total_end=$(date +%s)
total_elapsed=$((total_end - total_start))
total_minutes=$((total_elapsed / 60))
total_seconds=$((total_elapsed % 60))

printf "${BLUE}üéâ –í—Å—ë —á–∏—Å—Ç–æ! –ì–æ—Ç–æ–≤–∏–º—Å—è –∫ –∫–æ–º–º–∏—Ç—É...${NC}\n"
printf "${BLUE}‚è± –û–±—â–µ–µ –≤—Ä–µ–º—è: ${total_minutes} –º–∏–Ω ${total_seconds} —Å–µ–∫${NC}\n"

exit 0
